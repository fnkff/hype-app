<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Хайп</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            box-sizing: border-box;
        }
        body {
            background: #121212;
            margin: 0;
            padding: 20px;
            padding-bottom: 110px;
            color: #ffffff;
            overflow-y: auto;
        }
        .logo {
            font-size: 32px;
            font-weight: 700;
            color: #1DB954;
        }
        .beta-badge {
            font-size: 16px;
            color: #b3b3b3;
            margin-left: 8px;
            vertical-align: middle;
        }
        .balance {
            background: #2a2a2a;
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 18px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .pages-container {
            position: relative;
            min-height: 400px;
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            opacity: 0;
            visibility: hidden;
            transform: translateX(30px);
            transition: opacity 0.6s cubic-bezier(0.2, 0.9, 0.3, 1), transform 0.6s cubic-bezier(0.2, 0.9, 0.3, 1), visibility 0.6s ease;
            pointer-events: none;
        }
        .page.active-page {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
            pointer-events: auto;
        }

        /* ===== АНИМАЦИИ ===== */
        @keyframes fadeSlideUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .fade-slide-up {
            animation: fadeSlideUp 0.5s ease forwards;
        }

        .pulse {
            animation: pulse 0.2s ease;
        }

        /* ===== ЗАДАНИЯ ===== */
        .task {
            background: #2a2a2a;
            color: white;
            border-radius: 20px;
            padding: 20px;
            margin: 12px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0;
        }
        .task-info {
            flex: 1;
            min-width: 0;
        }
        .task-info h3 {
            margin: 0 0 4px;
            font-size: 20px;
            font-weight: 600;
            color: white;
            word-break: break-word;
        }
        .task-info p {
            margin: 0;
            color: #b3b3b3;
            font-size: 16px;
            word-break: break-word;
        }
        .task-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }
        .task-price {
            font-size: 20px;
            font-weight: 600;
            color: #1DB954;
            white-space: nowrap;
        }
        .take-btn {
            background: #1DB954;
            color: black;
            border: none;
            border-radius: 30px;
padding: 10px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
            white-space: nowrap;
        }
        .take-btn:hover {
            opacity: 0.8;
        }

        /* ===== ПРОФИЛЬ ===== */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 28px;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #1DB954;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: 600;
            color: #121212;
            text-transform: uppercase;
        }
        .profile-name {
            font-size: 28px;
            font-weight: 700;
            color: white;
        }
        .profile-stats {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .stat-card {
            background: #2a2a2a;
            color: white;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            opacity: 0;
        }
        .stat-content {
            flex: 1;
        }
        .stat-label {
            font-size: 16px;
            color: #b3b3b3;
            margin-bottom: 6px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        /* ===== РЕФЕРАЛЫ ===== */
        .referral-header {
            margin-bottom: 28px;
        }
        .referral-title {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 16px;
        }
        .referral-link-card {
            background: #2a2a2a;
            color: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 24px;
        }
        .referral-link-label {
            font-size: 16px;
            color: #b3b3b3;
            margin-bottom: 12px;
        }
        .referral-link-field {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .referral-link-input {
            flex: 1;
            min-width: 0;
            padding: 14px;
            border: 1px solid #3e3e3e;
            border-radius: 40px;
            font-size: 16px;
            background: #121212;
            color: white;
            outline: none;
            transition: border-color 0.2s;
        }
        .referral-link-input:focus {
            border-color: #1DB954;
        }
        .referral-copy-btn {
            background: #1DB954;
            color: black;
            border: none;
            border-radius: 40px;
            padding: 14px 28px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: opacity 0.2s;
            flex-shrink: 0;
            white-space: nowrap;
        }
        .referral-copy-btn:hover {
            opacity: 0.8;
        }
        .referral-stats {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .referral-stat-card {
            background: #2a2a2a;
            color: white;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            opacity: 0;
        }
        .referral-stat-content {
            flex: 1;
        }
        .referral-stat-label {
            font-size: 16px;
            color: #b3b3b3;
            margin-bottom: 6px;
        }
        .referral-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        /* ===== ВЫВОД ===== */
        .withdraw-balance-info {
            background: #2a2a2a;
            color: white;
            border-radius: 20px;
            padding: 20px;
margin-bottom: 28px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            opacity: 0;
        }
        .withdraw-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .withdraw-field {
            position: relative;
            margin-top: 10px;
            opacity: 0;
        }
        .withdraw-field input {
            width: 100%;
            padding: 16px 0 6px 0;
            border: none;
            border-bottom: 1px solid #3e3e3e;
            background: transparent;
            color: white;
            font-size: 18px;
            outline: none;
            transition: border-color 0.2s;
        }
        .withdraw-field input:focus {
            border-bottom-color: #1DB954;
        }
        .withdraw-field input::placeholder {
            color: #6a6a6a;
            font-size: 16px;
            transition: all 0.2s;
        }
        .withdraw-field input:focus::placeholder {
            transform: translateY(-12px);
            font-size: 14px;
            color: #b3b3b3;
        }
        .withdraw-btn {
            background: #1DB954;
            color: black;
            border: none;
            border-radius: 50px;
            padding: 18px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
            width: 100%;
            margin-top: 24px;
        }
        .withdraw-btn:hover {
            opacity: 0.8;
        }
        .withdraw-note {
            margin-top: 18px;
            color: #b3b3b3;
            text-align: center;
            font-size: 16px;
        }

        /* ===== НИЖНЕЕ МЕНЮ С ИКОНКАМИ ===== */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0a0a0a;
            display: flex;
            justify-content: space-around;
            padding: 14px;
            z-index: 100;
        }
        .nav-item {
            color: #6a6a6a;
            text-decoration: none;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: color 0.2s;
        }
        .nav-item.active {
            color: #1DB954;
        }
        .nav-item svg {
            width: 32px;
            height: 32px;
            display: block;
        }
        .nav-item svg path,
        .nav-item svg circle,
        .nav-item svg polygon {
            fill: currentColor;
            stroke: currentColor;
        }

        /* ===== МОДАЛЬНЫЕ ОКНА ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(3px);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
        }
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: #2a2a2a;
            width: 90%;
            max-width: 440px;
            border-radius: 28px;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .modal-header {
            background: #1e1e1e;
            padding: 24px;
            text-align: right;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #b3b3b3;
        }
        .modal-body {
            padding: 24px;
            color: white;
        }
        .modal-body h3 {
            font-size: 24px;
margin-bottom: 12px;
        }
        .ref-link {
            width: 100%;
            padding: 12px;
            margin: 12px 0;
            border: 1px solid #3e3e3e;
            border-radius: 40px;
            background: #121212;
            color: white;
            font-size: 16px;
        }
        .copy-btn, .check-btn {
            background: #1DB954;
            color: black;
            border: none;
            border-radius: 50px;
            padding: 16px;
            width: 100%;
            font-weight: 600;
            font-size: 18px;
            cursor: pointer;
            margin-top: 12px;
            transition: opacity 0.2s;
        }
        .copy-btn:hover, .check-btn:hover {
            opacity: 0.8;
        }
        .result {
            margin-top: 12px;
            text-align: center;
            color: #b3b3b3;
            font-size: 16px;
        }

        /* Адаптация для очень маленьких экранов */
        @media (max-width: 360px) {
            .logo {
                font-size: 28px;
            }
            .beta-badge {
                font-size: 14px;
            }
            .balance {
                font-size: 16px;
                padding: 8px 16px;
            }
            .task-info h3 {
                font-size: 18px;
            }
            .task-price, .task-actions .take-btn {
                font-size: 14px;
                padding: 8px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <span class="logo">ХАЙП</span>
            <span class="beta-badge">[бета тест]</span>
        </div>
        <div class="balance" id="balance">0 ₽</div>
    </div>

    <div class="pages-container">
        <div id="tasks-page" class="page active-page">
            <div id="tasks"></div>
        </div>

        <div id="profile-page" class="page">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar"></div>
                <div class="profile-name" id="profileName"></div>
            </div>
            <div class="profile-stats" id="profileStats"></div>
        </div>

        <div id="referrals-page" class="page">
            <div class="referral-header">
                <div class="referral-title">Реферальная программа</div>
            </div>
            <div class="referral-link-card">
                <div class="referral-link-label">Твоя реферальная ссылка</div>
                <div class="referral-link-field">
                    <input class="referral-link-input" value="https://t.me/your_bot?start=ref_123456" readonly id="refLinkField">
                    <button class="referral-copy-btn" onclick="this.previousElementSibling.select(); navigator.clipboard.writeText(this.previousElementSibling.value); alert('Ссылка скопирована!')">Копировать</button>
                </div>
            </div>
            <div class="referral-stats">
                <div class="referral-stat-card">
                    <div class="referral-stat-content">
                        <div class="referral-stat-label">Приглашено друзей</div>
                        <div class="referral-stat-value">0</div>
                    </div>
                </div>
                <div class="referral-stat-card">
                    <div class="referral-stat-content">
                        <div class="referral-stat-label">Заработано на рефералах</div>
                        <div class="referral-stat-value">0 ₽</div>
                    </div>
                </div>
            </div>
            <p class="withdraw-note">Статистика появится после приглашения друзей</p>
        </div>

        <div id="withdraw-page" class="page">
            <h3 style="color:white; margin-bottom:16px;">Вывод средств</h3>
            <div class="withdraw-info" id="withdrawContent"></div>
        </div>
    </div>

    <!-- НИЖНЕЕ МЕНЮ С ИКОНКАМИ SVG -->
    <div class="nav">
        <a class="nav-item active" data-page="tasks">
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M22.0002 5H25.0002C25.5302 5.00153 26.038 5.21274 26.4128 5.58748C26.7875 5.96222 26.9987 6.47004 27.0002 7V18H25.0002V7H22.0002V10H10.0002V7H7.00024V28H16.0002V30H7.00024C6.47028 29.9985 5.96246 29.7873 5.58772 29.4125C5.21298 29.0378 5.00177 28.53 5.00024 28V7C5.00177 6.47004 5.21298 5.96222 5.58772 5.58748C5.96246 5.21274 6.47028 5.00153 7.00024 5H10.0002V4C10.0018 3.47004 10.213 2.96222 10.5877 2.58748C10.9625 2.21274 11.4703 2.00153 12.0002 2H20.0002C20.5302 2.00153 21.038 2.21274 21.4128 2.58748C21.7875 2.96222 21.9987 3.47004 22.0002 4V5ZM12.0002 8H20.0002V4H12.0002V8ZM19.4102 24.5898L22.0002 27.1798L28.5902 20.5898L30.0002 21.9998L22.0002 29.9998L18.0002 25.9998L19.4102 24.5898Z"/>
            </svg>
            <span>Задания</span>
        </a>
        <a class="nav-item" data-page="profile">
            <svg width="32" height="32" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12,11A5,5,0,1,0,7,6,5.006,5.006,0,0,0,12,11Zm0-8A3,3,0,1,1,9,6,3,3,0,0,1,12,3ZM3,22V18a5.006,5.006,0,0,1,5-5h8a5.006,5.006,0,0,1,5,5v4a1,1,0,0,1-2,0V18a3,3,0,0,0-3-3H8a3,3,0,0,0-3,3v4a1,1,0,0,1-2,0Z"/>
            </svg>
            <span>Профиль</span>
        </a>
        <a class="nav-item" data-page="referrals">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                <path d="M26.375 14.976c1.164-1.395 1.852-3.297 1.852-5.325 0-4.19-2.913-7.6-6.492-7.6-2.484 0-4.644 1.641-5.735 4.046-1.09-2.405-3.251-4.047-5.734-4.047-3.58 0-6.492 3.41-6.492 7.601 0 2.033.686 3.932 1.851 5.325C3.589 15.933 0 17.729 0 23.134v1.995h6.124c-.245.813-.39 1.747-.39 2.826v1.995H26.265v-1.995c0-1.08-.145-2.013-.39-2.826H32v-1.995c0-5.405-3.589-7.2-5.625-8.158zm-19.32 8.158h-5.06c0-6.006 5.274-6.004 6.445-7.574l.134-.716C6.929 14.01 5.768 12 5.768 9.65c0-3.096 2.014-5.606 4.498-5.606 1.759 0 3.278 1.262 4.016 3.098-2.749.884-4.775 3.834-4.775 7.328 0 2.033.687 3.932 1.852 5.325-1.247.586-3.074 1.488-4.305 3.338zm9.003 4.821h-8.33c0-6.006 5.275-6.004 6.445-7.575l.134-.716c-1.644-.834-2.805-2.842-2.805-5.193 0-3.096 2.014-5.606 4.498-5.606 2.483 0 4.497 2.51 4.497 5.606 0 2.33-1.14 4.327-2.763 5.173l.153.814c1.284 1.495 6.383 1.592 6.383 7.497h-8.212zm8.886-4.82c-1.23-1.85-3.058-2.752-4.304-3.338 1.164-1.396 1.852-3.298 1.852-5.326 0-3.494-2.026-6.443-4.774-7.328.738-1.836 2.257-3.098 4.017-3.098 2.483 0 4.497 2.51 4.497 5.606 0 2.33-1.14 4.326-2.763 5.173l.153.814c1.284 1.494 6.383 1.592 6.383 7.496z"/>
            </svg>
            <span>Рефералы</span>
        </a>
        <a class="nav-item" data-page="withdraw">
            <svg height="32" viewBox="0 0 32 32" width="32" xmlns="http://www.w3.org/2000/svg">
                <path d="m29 4h-7v-1a3 3 0 0 0 -3-3h-6a3 3 0 0 0 -3 3v1h-7a3 3 0 0 0 -3 3v8a1 1 0 0 0 .74 1h.26v9a3 3 0 0 0 3 3h4a10 10 0 0 0 16 0h4a3 3 0 0 0 3-3v-9l.26-.06a1 1 0 0 0 .74-.94v-8a3 3 0 0 0 -3-3zm-17-1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v1h-8zm-10 4a1 1 0 0 1 1-1h26a1 1 0 0 1 1 1v7.23l-6.12 1.63a10 10 0 0 0 -15.76 0l-6.12-1.63zm2 19a1 1 0 0 1 -1-1v-8.43l4 1.06a9.91 9.91 0 0 0 -.16 8.37zm12 4a8 8 0 1 1 8-8 8 8 0 0 1 -8 8zm13-5a1 1 0 0 1 -1 1h-2.84a9.91 9.91 0 0 0 -.16-8.37l4-1.06z"/>
                <path d="m16 19h2a1 1 0 0 0 0-2h-1a1 1 0 0 0 -2 0v.18a3 3 0 0 0 1 5.82 1 1 0 0 1 0 2h-2a1 1 0 0 0 0 2h1a1 1 0 0 0 2 0v-.18a3 3 0 0 0 -1-5.82 1 1 0 0 1 0-2z"/>
            </svg>
            <span>Вывод</span>
        </a>
    </div>

    <!-- МОДАЛКИ -->
    <div class="modal" id="refModal">
        <div class="modal-content">
            <div class="modal-header"><button class="modal-close" id="closeRef">&times;</button></div>
            <div class="modal-body">
                <h3>Пригласи друга</h3>
                <p style="color:#b3b3b3;">Пригласи друга в Хайп. Когда он зарегистрируется и выполнит первое задание, ты получишь бонус 50 ₽.</p>
<input class="ref-link" id="refLink" readonly>
                <button class="copy-btn" id="copyBtn">Копировать ссылку</button>
            </div>
        </div>
    </div>

    <div class="modal" id="subModal">
        <div class="modal-content">
            <div class="modal-header"><button class="modal-close" id="closeSub">&times;</button></div>
            <div class="modal-body">
                <h3>Подпишись на канал</h3>
                <p style="color:#b3b3b3;">Подпишись на @HYPE_JOB1 и нажми проверку</p>
                <button class="check-btn" id="checkBtn">Проверить подписку</button>
                <div class="result" id="checkResult"></div>
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram?.WebApp;
        if (tg) tg.expand();
        const userId = tg?.initDataUnsafe?.user?.id || 'test_' + Math.random();
        const userName = tg?.initDataUnsafe?.user?.first_name || 'Пользователь';

        let counts = JSON.parse(localStorage.getItem('counts')) || {};
        let balance = parseInt(localStorage.getItem('balance')) || 0;
        document.getElementById('balance').innerText = balance + ' ₽';

        function saveBalance() {
            localStorage.setItem('balance', balance);
        }

        function addCount(id) {
            let key = id + '_' + new Date().toDateString();
            counts[key] = (counts[key] || 0) + 1;
            localStorage.setItem('counts', JSON.stringify(counts));
        }

        function canDo(id) {
            let key = id + '_' + new Date().toDateString();
            return !counts[key] || counts[key] < 3;
        }

        function getTodayCount() {
            const today = new Date().toDateString();
            let total = 0;
            for (let key in counts) {
                if (key.includes(today)) total += counts[key];
            }
            return total;
        }

        // Функция для анимации появления элементов
        function animateElements(elements, baseDelay = 0) {
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.classList.add('fade-slide-up');
                }, baseDelay + index * 100);
            });
        }

        // Функция для пульсации иконки
        function pulseIcon(item) {
            const svg = item.querySelector('svg');
            if (svg) {
                svg.classList.add('pulse');
                setTimeout(() => {
                    svg.classList.remove('pulse');
                }, 200);
            }
        }

        const tasks = [
            { id: 1, name: 'Пригласи друга', desc: 'Отправь ссылку', price: 50 },
            { id: 2, name: 'Подпишись на канал', desc: '@HYPE_JOB1', price: 30 }
        ];

        const container = document.getElementById('tasks');
        tasks.forEach(t => {
            const div = document.createElement('div');
            div.className = 'task';

            const infoDiv = document.createElement('div');
            infoDiv.className = 'task-info';
            const h3 = document.createElement('h3');
            h3.innerText = t.name;
            const p = document.createElement('p');
            p.innerText = t.desc;
            infoDiv.appendChild(h3);
            infoDiv.appendChild(p);

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'task-actions';
            const priceSpan = document.createElement('span');
            priceSpan.className = 'task-price';
            priceSpan.innerText = t.price + ' ₽';
            const btn = document.createElement('button');
            btn.className = 'take-btn';
            btn.setAttribute('data-id', t.id);
            btn.innerText = 'Взять';
            btn.onclick = function(e) {
                let id = parseInt(this.dataset.id);
                if (!canDo(id)) {
                    alert('Лимит на сегодня');
                    return;
                }
                if (id === 1) {
                    let link = 'https://t.me/your_bot?start=ref_' + userId;
document.getElementById('refLink').value = link;
                    document.getElementById('refModal').classList.add('show');
                } else {
                    document.getElementById('subModal').classList.add('show');
                }
            };

            actionsDiv.appendChild(priceSpan);
            actionsDiv.appendChild(btn);
            div.appendChild(infoDiv);
            div.appendChild(actionsDiv);
            container.appendChild(div);
        });

        // Анимируем карточки заданий после добавления
        setTimeout(() => {
            const tasksElements = document.querySelectorAll('.task');
            animateElements(tasksElements, 100);
        }, 100);

        document.getElementById('closeRef').onclick = () => {
            document.getElementById('refModal').classList.remove('show');
        };
        document.getElementById('copyBtn').onclick = () => {
            let inp = document.getElementById('refLink');
            inp.select();
            navigator.clipboard.writeText(inp.value).then(() => alert('Ссылка скопирована!'));
        };

        const subModal = document.getElementById('subModal');
        const closeSub = document.getElementById('closeSub');
        const checkBtn = document.getElementById('checkBtn');
        const checkResult = document.getElementById('checkResult');

        closeSub.onclick = () => subModal.classList.remove('show');

        checkBtn.onclick = async () => {
            if (!canDo(2)) {
                checkResult.style.color = 'red';
                checkResult.innerText = 'Лимит на сегодня';
                return;
            }
            checkBtn.disabled = true;
            checkBtn.innerText = 'Проверка...';
            checkResult.innerText = '';

            await new Promise(r => setTimeout(r, 1500));
            const success = true;

            if (success) {
                balance += 30;
                saveBalance();
                document.getElementById('balance').innerText = balance + ' ₽';
                addCount(2);
                checkResult.style.color = '#1DB954';
                checkResult.innerText = '✅ Подписка подтверждена! +30 ₽';
                setTimeout(() => subModal.classList.remove('show'), 1500);
            } else {
                checkResult.style.color = 'red';
                checkResult.innerText = '❌ Не подписан. Попробуйте снова.';
                checkBtn.disabled = false;
                checkBtn.innerText = 'Проверить подписку';
            }
        };

        const pages = {
            tasks: document.getElementById('tasks-page'),
            profile: document.getElementById('profile-page'),
            referrals: document.getElementById('referrals-page'),
            withdraw: document.getElementById('withdraw-page')
        };

        const navItems = document.querySelectorAll('.nav-item');

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                // Пульсация иконки
                pulseIcon(item);

                const page = item.dataset.page;
                const targetPage = pages[page];
                const currentActive = Object.values(pages).find(p => p.classList.contains('active-page'));

                if (!targetPage || targetPage === currentActive) return;

                if (currentActive) {
                    currentActive.classList.remove('active-page');
                }

                targetPage.classList.add('active-page');

                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                window.scrollTo(0, 0);

                // Анимируем элементы на новой странице
                setTimeout(() => {
                    if (page === 'tasks') {
                        const tasksElements = document.querySelectorAll('.task');
                        animateElements(tasksElements, 100);
                    } else if (page === 'profile') {
const profileElements = [
                            document.querySelector('.profile-header'),
                            ...document.querySelectorAll('.stat-card')
                        ].filter(el => el);
                        animateElements(profileElements, 100);
                    } else if (page === 'referrals') {
                        const refElements = [
                            document.querySelector('.referral-header'),
                            document.querySelector('.referral-link-card'),
                            ...document.querySelectorAll('.referral-stat-card')
                        ].filter(el => el);
                        animateElements(refElements, 100);
                    } else if (page === 'withdraw') {
                        const withdrawElements = [
                            document.querySelector('.withdraw-balance-info'),
                            ...document.querySelectorAll('.withdraw-field'),
                            document.querySelector('.withdraw-btn')
                        ].filter(el => el);
                        animateElements(withdrawElements, 100);
                    }
                }, 50);
            });
        });

        // Инициализация: анимируем активную страницу (задания) при загрузке
        setTimeout(() => {
            const tasksElements = document.querySelectorAll('.task');
            animateElements(tasksElements, 100);
        }, 200);

        function updateProfilePage() {
            const todayCount = getTodayCount();
            document.getElementById('profileName').innerText = userName;
            const avatarEl = document.getElementById('profileAvatar');
            if (userName && userName !== 'Пользователь') {
                avatarEl.innerText = userName.charAt(0).toUpperCase();
            } else {
                avatarEl.innerText = '?';
            }
            document.getElementById('profileStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-label">Баланс</div>
                        <div class="stat-value">${balance} ₽</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-label">Выполнено сегодня</div>
                        <div class="stat-value">${todayCount}</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-label">ID</div>
                        <div class="stat-value">${userId}</div>
                    </div>
                </div>
            `;
        }

        function updateReferralsPage() {
            // страница рефералов статична, ничего обновлять не нужно
        }

        function updateWithdrawPage() {
            document.getElementById('withdrawContent').innerHTML = `
                <div class="withdraw-balance-info">Текущий баланс: ${balance} ₽</div>
                <div class="withdraw-form">
                    <div class="withdraw-field">
                        <input type="number" id="withdrawAmount" placeholder="Сумма (мин. 50 ₽)" min="50" step="10">
                    </div>
                    <div class="withdraw-field">
                        <input type="text" id="withdrawCard" placeholder="Номер карты (16 цифр)" maxlength="19">
                    </div>
                    <button class="withdraw-btn">Вывести</button>
                </div>
                <p class="withdraw-note">Вывод будет доступен после бета-теста</p>
            `;
        }

        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        };

        updateProfilePage();
    </script>
</body>
</html>
