<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•–∞–π–ø</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: #75fe09;
            color: #000;
            margin: 0;
            padding: 16px;
            padding-bottom: 80px;
            font-family: Arial, sans-serif;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #000;
        }
        .balance {
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }
        .task-card {
            background: black;
            color: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task-info h3 {
            margin: 0 0 8px;
            font-size: 18px;
        }
        .task-info p {
            margin: 0;
            color: #ccc;
            font-size: 14px;
        }
        .task-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .task-price {
            font-size: 20px;
            font-weight: bold;
            color: white;
        }
        .take-btn {
            background: white;
            color: black;
            border: none;
            border-radius: 30px;
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
        }
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: black;
            display: flex;
            justify-content: space-around;
            padding: 12px;
        }
        .nav-item {
            color: #aaa;
            text-decoration: none;
            text-align: center;
        }
        .nav-item.active {
            color: white;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            z-index: 1000;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 24px;
            overflow: hidden;
            transform: scale(0.8);
            transition: transform 0.3s;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .modal-image {
            width: 100%;
            height: 200px;
            background-color: #ccc;
            background-size: cover;
            background-position: center;
        }
        .modal-body {
            padding: 20px;
            color: #000;
        }
        .modal-title {
            font-size: 22px;
            font-weight: bold;
            margin: 0 0 10px;
        }
        .modal-description {
            font-size: 16px;
            color: #333;
            margin: 0 0 20px;
        }
        .modal-price {
            font-size: 28px;
            font-weight: bold;
            color: #000;
            margin-bottom: 20px;
        }
        .modal-check-btn {
            background: #75fe09;
            border: none;
            border-radius: 40px;
            padding: 12px;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
cursor: pointer;
            margin-bottom: 10px;
        }
        .modal-start-btn {
            background: #75fe09;
            border: none;
            border-radius: 40px;
            padding: 16px;
            width: 100%;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.8);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 24px;
            cursor: pointer;
        }
        .referral-link {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
            background: #f5f5f5;
        }
        .copy-btn {
            background: #75fe09;
            border: none;
            border-radius: 20px;
            padding: 8px;
            width: 100%;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">–•–ê–ô–ü</div>
        <div class="balance" id="balance">1250 ‚ÇΩ</div>
    </div>

    <div id="tasks-list"></div>

    <div class="nav">
        <a href="#" class="nav-item active">üìã –ó–∞–¥–∞–Ω–∏—è</a>
        <a href="#" class="nav-item">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="#" class="nav-item">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</a>
        <a href="#" class="nav-item">üí∞ –í—ã–≤–æ–¥</a>
    </div>

    <div class="modal-overlay" id="taskModal">
        <div class="modal-content">
            <button class="modal-close" id="closeModalBtn">&times;</button>
            <div class="modal-image" id="modalImage"></div>
            <div class="modal-body">
                <h2 class="modal-title" id="modalTitle"></h2>
                <p class="modal-description" id="modalDesc"></p>
                <div class="modal-price" id="modalPrice"></div>
                <div id="dynamicContent"></div>
                <button class="modal-start-btn" id="modalStartBtn">–ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            </div>
        </div>
    </div>

    <script>
        // ===== Telegram WebApp =====
        let tg = window.Telegram?.WebApp;
        if (!tg) {
            document.body.innerHTML = '<div style="color: red; padding: 20px; text-align: center;">–û—à–∏–±–∫–∞: Telegram API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.</div>';
        } else {
            tg.expand();
            tg.ready();
            let userId = tg.initDataUnsafe?.user?.id || 'user';

            // ===== –õ–∏–º–∏—Ç—ã –∑–∞–¥–∞–Ω–∏–π (3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å) =====
            const takenTasks = JSON.parse(sessionStorage.getItem('takenTasks')) || {};

            function canTakeTask(taskId) {
                const today = new Date().toDateString();
                const key = taskId + '_' + today;
                if (takenTasks[key] && takenTasks[key] >= 3) {
                    alert('–í—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ 3 —Ä–∞–∑–∞ —Å–µ–≥–æ–¥–Ω—è');
                    return false;
                }
                return true;
            }

            function recordTaskCompleted(taskId) {
                const today = new Date().toDateString();
                const key = taskId + '_' + today;
                takenTasks[key] = (takenTasks[key] || 0) + 1;
                sessionStorage.setItem('takenTasks', JSON.stringify(takenTasks));
            }

            function updateBalance(amount) {
                let balanceEl = document.getElementById('balance');
                let cur = parseInt(balanceEl.innerText.replace(' ‚ÇΩ', '')) || 0;
                balanceEl.innerText = (cur + amount) + ' ‚ÇΩ';
            }

            // ===== –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏–π =====
            const tasks = [
                {
                    id: 1,
                    title: '–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞',
                    shortDesc: '–û—Ç–ø—Ä–∞–≤—å —Å–≤–æ—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É',
                    fullDesc: '–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –≤ –•–∞–π–ø. –ö–æ–≥–¥–∞ –æ–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ, —Ç—ã –ø–æ–ª—É—á–∏—à—å –±–æ–Ω—É—Å 50 ‚ÇΩ.',
price: 50,
                    image: 'https://via.placeholder.com/400x200/75fe09/000000?text=Referral'
                },
                {
                    id: 2,
                    title: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª',
                    shortDesc: '@hype_job',
                    fullDesc: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª @hype_job –∏ –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏',
                    price: 30,
                    image: 'https://via.placeholder.com/400x200/000000/75fe09?text=Telegram'
                }
            ];

            // ===== –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –∑–∞–¥–∞–Ω–∏–π =====
            const tasksList = document.getElementById('tasks-list');
            tasks.forEach(task => {
                const card = document.createElement('div');
                card.className = 'task-card';
                card.innerHTML = `
                    <div class="task-info">
                        <h3>${task.title}</h3>
                        <p>${task.shortDesc}</p>
                    </div>
                    <div class="task-actions">
                        <span class="task-price">${task.price} ‚ÇΩ</span>
                        <button class="take-btn" onclick="takeTask(${task.id})">–í–∑—è—Ç—å</button>
                    </div>
                `;
                tasksList.appendChild(card);
            });

            // ===== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ =====
            const modalOverlay = document.getElementById('taskModal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const modalDesc = document.getElementById('modalDesc');
            const modalPrice = document.getElementById('modalPrice');
            const modalStartBtn = document.getElementById('modalStartBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const dynamicContent = document.getElementById('dynamicContent');

            let currentTask = null;

            window.takeTask = function(taskId) {
                if (!canTakeTask(taskId)) return;
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;
                currentTask = task;

                modalImage.style.backgroundImage = url('${task.image}');
                modalTitle.innerText = task.title;
                modalDesc.innerText = task.fullDesc;
                modalPrice.innerText = task.price + ' ‚ÇΩ';

                dynamicContent.innerHTML = '';

                if (taskId === 2) {
                    dynamicContent.innerHTML = `
                        <button class="modal-check-btn" id="checkSubscribeBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                        <p id="checkResult"></p>
                    `;
                    setTimeout(() => {
                        document.getElementById('checkSubscribeBtn')?.addEventListener('click', checkSubscription);
                    }, 0);
                } else if (taskId === 1) {
                    const refLink = 'https://t.me/your_bot?start=ref_' + userId;
                    dynamicContent.innerHTML = `
                        <div>
                            <p><strong>–¢–≤–æ—è —Å—Å—ã–ª–∫–∞:</strong></p>
                            <input class="referral-link" id="refLink" value="${refLink}" readonly />
                            <button class="copy-btn" onclick="copyRefLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    `;
                }

                modalOverlay.classList.add('active');
            };

            function closeModal() {
                modalOverlay.classList.remove('active');
                currentTask = null;
            }

            closeModalBtn.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) closeModal();
            });

            // ===== –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (–∏–º–∏—Ç–∞—Ü–∏—è) =====
            async function checkSubscription() {
                const btn = document.getElementById('checkSubscribeBtn');
const result = document.getElementById('checkResult');
                if (!btn || !result) return;

                btn.disabled = true;
                btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';

                await new Promise(r => setTimeout(r, 1500));

                const success = Math.random() > 0.3;

                if (success) {
                    result.style.color = '#75fe09';
                    result.textContent = '‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞! +' + currentTask.price + ' ‚ÇΩ';
                    updateBalance(currentTask.price);
                    recordTaskCompleted(currentTask.id);
                    setTimeout(closeModal, 2000);
                } else {
                    result.style.color = 'red';
                    result.textContent = '‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
                }

                btn.disabled = false;
                btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É';
            }

            // ===== –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ =====
            window.copyRefLink = function() {
                const input = document.getElementById('refLink');
                if (input) {
                    input.select();
                    navigator.clipboard.writeText(input.value).then(() => {
                        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                    });
                }
            };

            // ===== –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ" =====
            modalStartBtn.addEventListener('click', function() {
                if (!currentTask) return;
                if (currentTask.id === 2) {
                    tg.showAlert('–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏');
                } else if (currentTask.id === 1) {
                    tg.showAlert('–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–∑—å—è–º. –ë–æ–Ω—É—Å –ø—Ä–∏–¥—ë—Ç –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                    closeModal();
                } else {
                    closeModal();
                }
            });
        }
    </script>
</body>
</html>
